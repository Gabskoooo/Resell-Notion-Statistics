{# templates/dashboard.html #}
{% extends 'base.html' %}

{% block title %}Tableau de Bord{% endblock %}

{% block content %}
<h1 class="mb-4">Votre Tableau de Bord</h1>

<div class="row">
    <div class="col-md-3"> {# Changé de md-4 à md-3 pour faire de la place pour 4 colonnes #}
        <div class="card text-center mb-3">
            <div class="card-header bg-primary text-white">
                Valeur Totale du Stock
            </div>
            <div class="card-body">
                <h2 class="card-title">{{ '%.2f'|format(total_stock_value) }}€</h2>
                <p class="card-text">Coût total des articles actuellement en stock.</p>
            </div>
            <div class="card-footer text-muted">
                <a href="{{ url_for('products') }}" class="btn btn-primary btn-sm">Voir les produits</a>
            </div>
        </div>
    </div>
    <div class="col-md-3"> {# Changé de md-4 à md-3 #}
        <div class="card text-center mb-3">
            <div class="card-header bg-success text-white">
                Bénéfice Total des Ventes
            </div>
            <div class="card-body">
                <h2 class="card-title">
                    {% if total_sales_profit is not none %}
                        {{ '%.2f'|format(total_sales_profit) }}€
                    {% else %}
                        0.00€
                    {% endif %}
                </h2>
                <p class="card-text">Bénéfice net cumulé de toutes vos ventes.</p>
            </div>
            <div class="card-footer text-muted">
                <a href="{{ url_for('sales') }}" class="btn btn-success btn-sm">Voir l'historique des ventes</a>
            </div>
        </div>
    </div>
    <div class="col-md-3"> {# Changé de md-4 à md-3 #}
        <div class="card text-center mb-3">
            <div class="card-header bg-info text-white">
                Chiffre d'Affaires Total
            </div>
            <div class="card-body">
                <h2 class="card-title">
                    {% if total_revenue is not none %}
                        {{ '%.2f'|format(total_revenue) }}€
                    {% else %}
                        0.00€
                    {% endif %}
                </h2>
                <p class="card-text">Total des revenus bruts de toutes les ventes enregistrées.</p>
            </div>
            <div class="card-footer text-muted">
                <a href="{{ url_for('sales') }}" class="btn btn-info btn-sm">Gérer les ventes</a>
            </div>
        </div>
    </div>
    {# NOUVEAU BLOC : Résultat Net #}
    <div class="col-md-3"> {# Nouvelle colonne pour le Résultat Net #}
        <div class="card text-center mb-3">
            <div class="card-header {% if net_result >= 0 %}bg-success{% else %}bg-danger{% endif %} text-white">
                Résultat Net
            </div>
            <div class="card-body">
                <h2 class="card-title">
                    {% if net_result is not none %}
                        {{ '%.2f'|format(net_result) }}€
                    {% else %}
                        0.00€
                    {% endif %}
                </h2>
                <p class="card-text">Bénéfice total après toutes les opérations.</p>
            </div>
            <div class="card-footer text-muted">
                {# Vous pouvez ajouter un lien ici si vous créez une page pour les opérations supplémentaires #}
                <a href="{{ url_for('supplementary_operations') }}" class="btn btn-secondary btn-sm">Voir les opérations</a> {# Remplacez par votre vraie route #}
            </div>
        </div>
    </div>
</div>

<h2 class="mt-4 mb-3">Dernières Ventes</h2>
{% if latest_sales %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Nom</th>
                <th>SKU</th>
                <th>Taille</th>
                <th>Prix Vente (€)</th>
                <th>Prix Achat (€)</th>
                <th>Frais Port (€)</th>
                <th>Frais Platf. (€)</th>
                <th>Bénéfice (€)</th>
                <th>Date Vente</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in latest_sales %}
            <tr>
                <td>{{ sale.item_name }}</td>
                <td>{{ sale.sku }}</td>
                <td>{{ sale.size }}</td>
                <td>{{ sale.sale_price_formatted }}</td>
                <td>{{ sale.purchase_price_at_sale_formatted }}</td>
                <td>{{ sale.shipping_cost_formatted }}</td>
                <td>{{ sale.fees_formatted }}</td>
                <td>
                    <span class="badge {% if sale.profit > 0 %}bg-success{% elif sale.profit < 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                        {{ sale.profit_formatted }}
                    </span>
                </td>
                <td>{{ sale.sale_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
    <p>Aucune vente enregistrée pour le moment.</p>
{% endif %}
{% endblock %}